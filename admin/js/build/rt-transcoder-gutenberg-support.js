!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t){!function(){e.exports=this.wp.element}()},function(e,t){!function(){e.exports=this.wp.i18n}()},function(e,t){!function(){e.exports=this.wp.data}()},function(e,t){!function(){e.exports=this.wp.components}()},function(e,t){!function(){e.exports=this.wp.hooks}()},function(e,t){!function(){e.exports=this.regeneratorRuntime}()},function(e,t){function r(e,t,r,n,o,i,a){try{var c=e[i](a),d=c.value}catch(e){return void r(e)}c.done?t(d):Promise.resolve(d).then(n,o)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function c(e){r(a,o,i,c,d,"next",e)}function d(e){r(a,o,i,c,d,"throw",e)}c(void 0)}))}}},function(e,t){!function(){e.exports=this.wp.compose}()},function(e,t){!function(){e.exports=this.wp.blockEditor}()},function(e,t){!function(){e.exports=this.wp.apiFetch}()},function(e,t,r){"use strict";r.r(t);var n=r(5),o=r.n(n),i=r(6),a=r.n(i),c=r(0),d=r(7),s=r(3),u=r(4),l=r(1),p=r(8),f=r(9),b=r.n(f),m=r(2),v=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Object(c.createElement)(s.Notice,{status:e,isDismissible:r},t)},y=function(e){Object(m.dispatch)("core/notices").createNotice("info",e,{isDismissible:!0,type:"snackbar"})},g=Object(m.select)("core/block-editor"),h=g.getBlocksByClientId,_=g.getClientIdsWithDescendants,k=["amp/amp-story-page","core/video"],O=window.rtTranscoderBlockEditorSupport,j=void 0!==O.rt_default_video_quality?O.rt_default_video_quality:"high",w=void 0!==O.is_transcoding_enabled?O.is_transcoding_enabled:"false";Object(u.addFilter)("blocks.registerBlockType","transcoder/ampStoryBackgroundVideoQuality",(function(e,t){return k.includes(t)&&"amp_story"===O.current_post_type&&"false"!==w?(void 0!==e.attributes&&(e.attributes=Object.assign(e.attributes,{rtBackgroundVideoInfo:{type:"object"},rtBackgroundVideoQuality:{type:"string",default:j}})),e):e}),9);var B=Object(d.createHigherOrderComponent)((function(e){return function(t){if(!k.includes(t.name)||"amp_story"!==O.current_post_type||"false"===w)return Object(c.createElement)(e,t);var r=t.attributes,n="amp/amp-story-page"===t.name,o="core/video"===t.name,i=r.mediaType?r.mediaType:"",a=n?r.mediaId:r.id,d=r.rtBackgroundVideoQuality,u=r.rtBackgroundVideoInfo;return Object(c.createElement)(c.Fragment,null,Object(c.createElement)(e,t),(o||n&&"video"===i)&&void 0!==a&&Object(c.createElement)(p.InspectorControls,null,Object(c.createElement)(s.PanelBody,{title:Object(l.__)("Transcoder Settings","transcoder"),initialOpen:!0},void 0===u&&v("error",Object(l.__)("Please wait while the video is being Transcoded. Quality settings will be available once transcoding is complete.","transcoder"),!1),void 0!==u&&Object(c.createElement)(s.SelectControl,{label:Object(l.__)("Background Video Quality","transcoder"),value:d,options:[{value:"low",label:Object(l.__)("Low","transcoder")},{value:"medium",label:Object(l.__)("Medium","transcoder")},{value:"high",label:Object(l.__)("High","transcoder")}],onChange:function(e){t.setAttributes({rtBackgroundVideoQuality:e})}}))))}}),"withTranscoderSettings");Object(u.addFilter)("editor.BlockEdit","rt-transcoder-amp/with-transcoder-settings",B,12);var V=function(){var e=a()(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,"/transcoder/v1/amp-media",e.next=4,b()({path:"".concat("/transcoder/v1/amp-media","/").concat(t),method:"GET"});case 4:if(!1===(r=e.sent)||null===r){e.next=9;break}return e.abrupt("return",r);case 9:return e.abrupt("return",!1);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}();Object(u.addFilter)("editor.BlockEdit","rt-transcoder-amp/set-media-attributes",(function(e){return function(t){if(!k.includes(t.name)||"amp_story"!==O.current_post_type||"false"===w)return Object(c.createElement)(e,t);var r=t.attributes,n="amp/amp-story-page"===t.name,o="core/video"===t.name;if(void 0!==(n?r.mediaId:r.id))if(void 0===r.poster)n&&void 0!==r.mediaType&&"video"===r.mediaType?(r.mediaUrl.endsWith("mp4")||t.setAttributes({poster:O.amp_story_fallback_poster}),y(Object(l.__)("Please wait while the video is being Transcoded. Video URL and thumbnails will be updated automatically.","transcoder"))):o&&void 0!==r.src&&0!==r.src.indexOf("blob:")&&(r.src.endsWith("mp4")||t.setAttributes({poster:O.amp_video_fallback_poster}),y(Object(l.__)("Please wait while the video is being Transcoded. Video URL and thumbnails will be updated automatically.","transcoder")));else if(void 0!==t.attributes.rtBackgroundVideoInfo){var i=t.attributes.rtBackgroundVideoInfo,a=t.attributes.rtBackgroundVideoQuality?t.attributes.rtBackgroundVideoQuality:j;i.poster.length&&i[a].transcodedMedia.length&&(n&&void 0!==r.mediaType&&"video"===r.mediaType?t.setAttributes({poster:i.poster,mediaUrl:i[a].transcodedMedia,src:i[a].transcodedMedia,rtBackgroundVideoQuality:a}):o&&t.setAttributes({poster:i.poster,src:i[a].transcodedMedia,rtBackgroundVideoQuality:a}))}var d=t.attributes.rtBackgroundVideoQuality;return d?t.setAttributes({className:"has-quality-".concat(d)}):t.setAttributes({rtBackgroundVideoQuality:j}),Object(c.createElement)(e,t)}}),11),setInterval((function(){var e=h(_());if(e.length){var t=!0,r=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;a.name.length&&k.includes(a.name)&&"amp_story"===O.current_post_type&&"true"===w&&function(){var e=a.attributes,t=a.clientId;if(void 0!==t&&void 0===e.rtBackgroundVideoInfo){var r="amp/amp-story-page"===a.name,n="core/video"===a.name,o=r?e.mediaId:e.id;void 0!==o&&V(o).then((function(o){if(!1!==o&&null!==o){var i=o,a=e.rtBackgroundVideoQuality?e.rtBackgroundVideoQuality:j;void 0!==i&&i.poster.length&&i[a].transcodedMedia.length&&(r&&void 0!==e.mediaType&&"video"===e.mediaType?(Object(m.dispatch)("core/block-editor").updateBlockAttributes(t,{poster:i.poster,mediaUrl:i[a].transcodedMedia,src:i[a].transcodedMedia,rtBackgroundVideoInfo:o}),y(Object(l.__)("Video has been Transcoded, you may now select desired quality from block settings.","transcoder"))):n&&(Object(m.dispatch)("core/block-editor").updateBlockAttributes(t,{poster:i.poster,src:i[a].transcodedMedia,rtBackgroundVideoInfo:o}),y(Object(l.__)("Video has been Transcoded, you may now select desired quality from block settings.","transcoder"))))}}))}}()}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}}),1e4)}]);