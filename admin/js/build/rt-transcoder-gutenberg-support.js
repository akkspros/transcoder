!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=10)}([function(t,e){!function(){t.exports=this.wp.element}()},function(t,e){!function(){t.exports=this.wp.i18n}()},function(t,e){!function(){t.exports=this.wp.hooks}()},function(t,e){!function(){t.exports=this.wp.data}()},function(t,e){!function(){t.exports=this.regeneratorRuntime}()},function(t,e){!function(){t.exports=this.wp.components}()},function(t,e){function r(t,e,r,n,o,i,a){try{var c=t[i](a),d=c.value}catch(t){return void r(t)}c.done?e(d):Promise.resolve(d).then(n,o)}t.exports=function(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function c(t){r(a,o,i,c,d,"next",t)}function d(t){r(a,o,i,c,d,"throw",t)}c(void 0)}))}}},function(t,e){!function(){t.exports=this.wp.compose}()},function(t,e){!function(){t.exports=this.wp.blockEditor}()},function(t,e){!function(){t.exports=this.wp.apiFetch}()},function(t,e,r){"use strict";r.r(e);var n=r(4),o=r.n(n),i=r(6),a=r.n(i),c=r(0),d=r(7),u=r(5),s=r(2),l=r(1),p=r(8),f=r(9),m=r.n(f),b=r(3),v=Object(b.select)("core/block-editor"),y=v.getBlocksByClientId,g=v.getClientIdsWithDescendants,h=["amp/amp-story-page","core/video"],_=window.rtTranscoderBlockEditorSupport,k=void 0!==_.rt_default_video_quality?_.rt_default_video_quality:"high";Object(s.addFilter)("blocks.registerBlockType","transcoder/ampStoryBackgroundVideoQuality",(function(t,e){return h.includes(e)&&"amp_story"===_.current_post_type?(void 0!==t.attributes&&(t.attributes=Object.assign(t.attributes,{rtBackgroundVideoInfo:{type:"object"},rtBackgroundVideoQuality:{type:"string",default:k}})),t):t}),9);var O=Object(d.createHigherOrderComponent)((function(t){return function(e){if(!h.includes(e.name)||"amp_story"!==_.current_post_type)return Object(c.createElement)(t,e);var r=e.attributes,n="amp/amp-story-page"===e.name,o="core/video"===e.name,i=r.mediaType?r.mediaType:"",a=r.rtBackgroundVideoQuality;return Object(c.createElement)(c.Fragment,null,Object(c.createElement)(t,e),(o||n&&"video"===i)&&Object(c.createElement)(p.InspectorControls,null,Object(c.createElement)(u.PanelBody,{title:Object(l.__)("Transcoder Settings","transcoder"),initialOpen:!0},Object(c.createElement)(u.SelectControl,{label:Object(l.__)("Background Video Quality","transcoder"),value:a,options:[{value:"low",label:Object(l.__)("Low","transcoder")},{value:"medium",label:Object(l.__)("Medium","transcoder")},{value:"high",label:Object(l.__)("High","transcoder")}],onChange:function(t){e.setAttributes({rtBackgroundVideoQuality:t})}}))))}}),"withTranscoderSettings");Object(s.addFilter)("editor.BlockEdit","rt-transcoder-amp/with-transcoder-settings",O,12);var j=function(){var t=a()(o.a.mark((function t(e){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,"/transcoder/v1/amp-media",t.next=4,m()({path:"".concat("/transcoder/v1/amp-media","/").concat(e),method:"GET"});case 4:if(!1===(r=t.sent)||null===r){t.next=9;break}return t.abrupt("return",r);case 9:return t.abrupt("return",!1);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.log(t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}();Object(s.addFilter)("editor.BlockEdit","rt-transcoder-amp/set-media-attributes",(function(t){return function(e){if(!h.includes(e.name)||"amp_story"!==_.current_post_type)return Object(c.createElement)(t,e);var r=e.attributes,n="amp/amp-story-page"===e.name,o="core/video"===e.name;if(void 0!==(n?r.mediaId:r.id))if(void 0===r.poster)n&&void 0!==r.mediaType&&"video"===r.mediaType&&!r.mediaUrl.endsWith("mp4")?e.setAttributes({poster:_.amp_story_fallback_poster}):o&&void 0!==r.src&&0!==r.src.indexOf("blob:")&&!r.src.endsWith("mp4")&&e.setAttributes({poster:_.amp_video_fallback_poster});else if(void 0!==e.attributes.rtBackgroundVideoInfo){var i=e.attributes.rtBackgroundVideoInfo,a=e.attributes.rtBackgroundVideoQuality?e.attributes.rtBackgroundVideoQuality:k;i.poster.length&&i[a].transcodedMedia.length&&(n&&void 0!==r.mediaType&&"video"===r.mediaType?e.setAttributes({poster:i.poster,mediaUrl:i[a].transcodedMedia,src:i[a].transcodedMedia,rtBackgroundVideoQuality:a}):o&&e.setAttributes({poster:i.poster,src:i[a].transcodedMedia,rtBackgroundVideoQuality:a}))}var d=e.attributes.rtBackgroundVideoQuality;return d?e.setAttributes({className:"has-quality-".concat(d)}):e.setAttributes({rtBackgroundVideoQuality:k}),Object(c.createElement)(t,e)}}),11),setInterval((function(){var t=y(g());if(t.length){var e=!0,r=!1,n=void 0;try{for(var o,i=t[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a=o.value;a.name.length&&h.includes(a.name)&&"amp_story"===_.current_post_type&&function(){var t=a.attributes,e=a.clientId;if(void 0!==e&&void 0===t.rtBackgroundVideoInfo){var r="amp/amp-story-page"===a.name,n="core/video"===a.name,o=r?t.mediaId:t.id;void 0!==o&&j(o).then((function(o){if(!1!==o&&null!==o){var i=o,a=t.rtBackgroundVideoQuality?t.rtBackgroundVideoQuality:k;void 0!==i&&i.poster.length&&i[a].transcodedMedia.length&&(r&&void 0!==t.mediaType&&"video"===t.mediaType?Object(b.dispatch)("core/block-editor").updateBlockAttributes(e,{poster:i.poster,mediaUrl:i[a].transcodedMedia,src:i[a].transcodedMedia,rtBackgroundVideoInfo:o}):n&&Object(b.dispatch)("core/block-editor").updateBlockAttributes(e,{poster:i.poster,src:i[a].transcodedMedia,rtBackgroundVideoInfo:o}))}}))}}()}}catch(t){r=!0,n=t}finally{try{e||null==i.return||i.return()}finally{if(r)throw n}}}}),1e4)}]);